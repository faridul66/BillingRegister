@model BJProduction.Models.Sales_Order

@{
    ViewBag.Title = "Edit";
    Layout = "~/Views/Shared/index.cshtml";
}

<head>
    <link href="~/Content/Exp/Select2.css" rel="stylesheet" />
    <link href="~/Content/Exp/select2-bootstrap4.css" rel="stylesheet" />
    <!-- select2-bootstrap4-theme -->

</head>


@{
    ;
}


<div class="main-card mb-3 card animated fadeIn OrderArea">
    <div class="card-body">
        <h5 class="card-title">Sales Order</h5>
        @Html.HiddenFor(model => model.status)
        <div class="form-row">
            <div class="col-md-4">
                <div class="position-relative form-group"><label for="" class="">Company</label>@Html.DropDownList("Companyid", null, htmlAttributes: new { @class = "form-control" })</div>
            </div>
            <div class="col-md-3">
                <div class="position-relative form-group"><label for="" class="">Sales Order</label>@Html.EditorFor(model => model.order_no, new { htmlAttributes = new { @class = "form-control" } })</div>
            </div>
            <div class="col-md-3">
                <div class="position-relative form-group"><label for="" class="">Lot Number</label><input name="" id="Lot" type="text" class="form-control"></div>
            </div>
            @*<div class="col-md-2">
                <div class="position-relative form-group">
                    <label for="" class=""> </label>
                    <button id="Gen" class="mb-2 mr-2 btn btn-success btn-primary btn-lg btn-block">
                        Go
                    </button>
                </div>
            </div>*@
        </div>
        <div class="form-row Header_Section_1">
            <div class="col-md-2">
                <div class="position-relative form-group"><label for="" class="">Sell Date</label>@Html.EditorFor(model => model.sell_date, new { htmlAttributes = new { @class = "form-control", @data_toggle = "datepicker" } })</div>
            </div>

            <div class="col-md-4">
                <div class="position-relative form-group"><label for="" class="">Customer</label> @Html.DropDownList("Customerid", null, htmlAttributes: new { @class = "form-control" })</div>
            </div>
            <div class="col-md-2">
                <div class="position-relative form-group"><label for="" class="">Country</label>@Html.DropDownList("Locationid", null, htmlAttributes: new { @class = "form-control" })</div>
            </div>
            <div class="col-md-2">
                <div class="position-relative form-group"><label for="" class="">Sales Type</label><input disabled="" name="" id="SalesType" type="text" class="form-control"></div>
            </div>
        </div>
        @*<div class="form-row Header_Section_2">

            </div>*@

        @*<button class="mt-2 btn btn-primary">Save</button>*@

    </div>
</div>
<div class="main-card mb-3 card animated fadeIn ProductAttr_Section OrderArea">
    <div class="card-body">
        <h5 class="card-title">Product Type</h5>
        <div class="form-row">
            <div class="col-md-3">
                <div class="position-relative form-group"><label for="" class="">Product Type</label> @Html.DropDownList("Product_Typeid", null, htmlAttributes: new { @class = "form-control" })</div>
            </div>
            <div class="col-md-2">
                <div class="position-relative form-group"><label for="" class="">Total Count</label>@Html.EditorFor(model => model.qty, new { htmlAttributes = new { @class = "form-control" ,@type=""} })</div>
            </div>
            <div class="col-md-2">
                <div class="position-relative form-group"><label for="" class="">Delivery Date</label><input id="Delivery_Date" class="form-control" , data-toggle="datepicker"></div>
            </div>
            <div class="col-md-2 MainFeature">

            </div>
            <div class="col-md-2 MainUnit">
                <div class="position-relative form-group"><label for="" class="">Unit</label><select class="form-control" id="MainUnit"></select></div>
            </div>
        </div>
        <hr />
        <div id="DynaComb" class="">
            <div id="1" class="form-row">
                <div class="col-md-2">
                </div>
            </div>
        </div>
        <div id="DynaComb2" class="">
            <div id="1" class="form-row">
                <div class="col-md-2">
                </div>
            </div>
        </div>
        <hr />
        <div class="form-row">
            <!--    <div class="col-md-2">
                <div class="position-relative form-group"><label for="" class="">Multisite</label><input type="checkbox" class="form-control Multisite"></div>
            </div>
                <div class="position-relative form-check form-check-inline">
                <label class="form-check-label">
                    <input type="checkbox" class="form-check-input Multisite"> Multisite
                </label>
            </div>
                <div class="form-check">
                <label style="padding-right:5px" for="inlineCheckbox1" class="form-check-label">Multisite</label><input class="Multisite" type="checkbox" checked data-toggle="toggle" data-on="Yes" data-off="No" data-onstyle="success" data-offstyle="default">

            </div> -->
            <div class="col-md-2 SiteLoader OrderArea">
                @*<div class="position-relative form-group"><label for="" class="">Site</label> <select class="form-control Site"></select></div>*@
            </div>
            <div class="col-md-2 WarehouseLoader OrderArea">
                @*<div class="position-relative form-group"><label for="" class="">Warehouse</label><input class="form-control"></div>*@
            </div>
           
        </div>
    </div>
</div>


<div class="col-md-12">
    <div class="main-card mb-3 card">
        <div class="card-body">
            <h5 class="card-title">Product to Sale</h5>
            <div class="form-row">
                <div class="col-md-10">
                    <div class="position-relative form-group">
                        <label for="" class="">Product Serial</label>
                        <select id="Products" class="Products form-control" multiple>
                        </select>
                    </div>
                </div>

                <div class="col-md-2">
                    <div class="position-relative form-group">
                        <label for="" class="" style="color:white"> .</label>
                        <button id="AddtoList" class="mb-2 mr-2 btn btn-success btn-primary btn-lg btn-block">
                            Add to List
                        </button>
                    </div>
                </div>
            </div>
            <div class="form-row">
                <table class="mb-0 table table-hover">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Item</th>
                            <th>Serial No.</th>
                            <th>Weight</th>
                            <th>Unit</th>
                            <th>Time</th>
                           </tr>
                    </thead>
                    <tbody id="YetToSale">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>
@*<div class="main-card mb-3 card animated fadeIn ProductDtl_Section">
    <div class="card-body">
        <h5 class="card-title">Products</h5>
        <table class="mb-0 table table-hover">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Serial No.</th>
                    <th>Weight</th>
                    <th>Unit</th>
                </tr>
            </thead>
            <tbody id="GeneratedRows">
            </tbody>
        </table>
    </div>
</div>*@
<div class="Button_Section" style=" position: fixed; bottom: 40px; right: 40px">
    <button id="UpdateBtn" class="btn btn-success btn-lg">Update</button>
    <button id="SubmitBtn" class="btn btn-success btn-lg" style="display:none">Submit Sales Order</button>
</div>

<div class="body-block-example-2 d-none">
    <div class="loader bg-transparent no-shadow">
        <div class="ball-pulse-rise">
            <div style="background-color: rgb(253, 126, 20);"></div>
            <div style="background-color: rgb(253, 126, 20);"></div>
            <div style="background-color: rgb(253, 126, 20);"></div>
            <div style="background-color: rgb(253, 126, 20);"></div>
            <div style="background-color: rgb(253, 126, 20);"></div>
        </div>
    </div>

</div>
@section scripts{
    <script type="text/javascript">

        $(document).ajaxStart(function () {
            $.LoadingOverlay("show");
        });
        $(document).ajaxStop(function () {
            $.LoadingOverlay("hide");
        });

        //$(document.body).on("click", "#GenerateDBtn", function () {
        //    var SiteProductCount = $(".SiteProductCountVal").val();
        //    if (SiteProductCount.length != 0) {
        //        $("#DynaComb > div > div > div > select").each(function () {
        //            Dyna_Id = this.getAttribute('id');
        //            Dyna_Value = $(this).val();
        //            Dynamic_Attr.push([this.getAttribute('id'), $(this).val()]);
        //        });
        //        var sData = [$("#Companyid").val(), $("#order_no").val(), $("#Lot").val(), $("#Product_Typeid").val()];
        //        console.log(Dynamic_Attr);
        //        var DynamicAttributes = [sData, Dynamic_Attr];


        //        for (let i = 0; i < SiteProductCount; i++) {
        //            $("#GeneratedRows").append("<tr><th class=\"RowNumber\" scope =\"row\">" + (i + 1) + "</th><td><input class=\"form-control SLN\"></td><td><input class=\"form-control QTYVal\"></td><td class =\" Unit\">KG</td></tr>")
        //        }
        //        $(this).addClass("disabled").attr("disabled", "");
        //    } else {
        //        alert("Please Input Number of Rows to be Generated")
        //    }
        //});

        $(window).on('load', function () {


            $.blockUI.defaults = {
                timeout: 0,
                overlayCSS: {
                    backgroundColor: '#fff',
                    opacity: 0.7,
                    cursor: 'wait'
                },

            }
            $.blockUI({
                message: $('.body-block-example-2')
            });

        });


        $(document).ready(function () {


            $(".Products").select2({
                theme: 'bootstrap4',
                closeOnSelect: false
            });
            if ($("#Products").val().length === 0) {
                $("#AddtoList").prop("disabled", true);
            }
            else {
                $("#AddtoList").prop("disabled", false);
            }
            $("#Products").on('change', function (e) {
                if ($("#Products").val().length === 0) {
                    $("#AddtoList").prop("disabled", true);
                }
                else {
                    $("#AddtoList").prop("disabled", false);
                }
            });

        $("#Featureid").empty();
        $(".Site").empty();
        $(".Warehouse").empty();

        var prodtid = $("#Product_Typeid").val();
        MainFeature_Id = null;

        LoadDynamicFeature("",prodtid);
            LoadProducts();
             LoadYetToSale(@Model.id);

        $(".Warehouse").append("<div class=\"position-relative form-group\"><label for=\"\" class=\"\">Warehouse</label><select id=\"WHID\" class=\"form-control\"></select></div>");
        var compid = $("#Companyid").val();


        var Country = $("#Locationid  option:selected").text();
        if (Country == 'Bangladesh') {
            $("#SalesType").val("Local");
        } else {
            $("#SalesType").val("Import");
        }


        if (compid != undefined && compid != '') {
            var json = {
                id: compid
            }
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetSite", "Purchase_Order")',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(json),
                success: function(data) {
                    $(".SiteLoader").empty();
                    $(".SiteLoader").append("<div class=\"position-relative form-group\"><label for=\"\" class=\"\">Site</label><select class=\"form-control Site\"></select></div>")
                    $.each(data, function(key, value) {
                        $(".Site").append("<option value=\"" + value.Locations.id + "\">" + value.Locations.name + "</option>");
                    });

                    var siteid = $(".Site").val();
                    if (siteid != undefined && siteid != '') {
                        var json = {
                            id: siteid
                        }
                        $.ajax({
                            type: "POST",
                            url: '@Url.Action("GetWh", "Purchase_Order")',
                            contentType: "application/json; charset=utf-8",
                            data: JSON.stringify(json),
                            success: function(data) {
                                $(".WarehouseLoader").empty();
                                $(".SiteProductCount").empty();
                                $(".WarehouseLoader").append("<div class=\"position-relative form-group\"><label for=\"\" class=\"\">Warehouse</label><select class=\"form-control Warehouse\"></select></div>")
                                $(".SiteProductCount").append("<div class=\"position-relative form-group\"><label for=\"\" class=\"\">Count</label><input class=\"form-control SiteProductCountVal  input-mask-trigger\" data-inputmask=\"'alias': 'decimal', 'groupSeparator': ',', 'autoGroup': true\" im-insert=\"true\"></div>")
                                $.each(data, function(key, value) {
                                    //alert("hi");
                                    $(".Warehouse").append("<option value=\"" + value.id + "\">" + value.name + "</option>");

                                });
                            }
                        });
                    }
                }
            });
        }
        //$(".Header_Section_1").hide();
        //$(".Header_Section_2").hide();
        //$(".ProductAttr_Section").hide();
        //$(".ProductDtl_Section").hide();
        //$(".Button_Section").hide();
            $.unblockUI();
    });


    // Product Type Change Event
    $(document.body).on("change", "#Product_Typeid", function() {
        //var prodtid = $(this).val();

        LoadDynamicFeature("change",$(this).val())

    });
    // Site Change Event
    $(document.body).on("change", ".Site", function() {
        var siteid = $(this).val();
        if (siteid != undefined && siteid != '') {
            var json = {
                id: siteid
            }
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetWh", "Purchase_Order")',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(json),
                success: function(data) {
                    $(".WarehouseLoader").empty();
                    $(".SiteProductCount").empty();
                    $(".WarehouseLoader").append("<div class=\"position-relative form-group\"><label for=\"\" class=\"\">Warehouse</label><select class=\"form-control Warehouse\"></select></div>")
                    $(".SiteProductCount").append("<div class=\"position-relative form-group\"><label for=\"\" class=\"\">Count</label><input class=\"form-control SiteProductCountVal\"></div>")
                    $.each(data, function(key, value) {
                        //alert("hi");
                        $(".Warehouse").append("<option value=\"" + value.id + "\">" + value.name + "</option>");

                    });
                }
            });
        }
    });

    // Declaring Global Variable,
    // VarData = All Single Select or Input elements value. (Arr)
    // Dynamic_Attrs = All Dynamic Product Feature Type. (Arr)
    // Product_Details = Product Serial and Table Data. (Arr)
    // DTS= Data to Save on Submit or Save. (Arr)

        var Company_Id, Order_No, Sales_Date, Customer_Id, LC_Number, LC_Date, Country_Id, Purchase_Type, Product_Type_Id, Total_Count, Delivery_Date, MainFeature_Id, MainFeature_Value, MainFeature_Unit, Site_Id, Warehouse_Id, Product_Count, Lot_Number, OrderId;
    var Dynamic_Attr = [],
        Dynamic_AttrTxt = [],
        Products_Details = [],
        VarData = [],
        DTS = [];


        $("#UpdateBtn").click(function() {
        toastr.options = {
            "closeButton": true,
            "debug": false,
            "newestOnTop": false,
            "progressBar": true,
            "positionClass": "toast-top-full-width",
            "preventDuplicates": true,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "30000",
            "extendedTimeOut": "30000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        }

        //VarData, Dynamic_Attr, Products_Details, DTS = null;

        VarData.length = 0;
        Dynamic_Attr.length = 0;
        Dynamic_AttrTxt.length = 0;
        Products_Details.length = 0;
        DTS.length = 0;
            OrderId=@Model.id;
        Company_Id = $("#Companyid").val();
        Customer_Id = $("#Customerid").val();
        Product_Type_Id = $("#Product_Typeid").val();
        Total_Count = $("#qty").val();
        //MainFeature_Id = ""; //Data loaded from Product Type On Change Event, Product Type Load Event.
        MainFeature_Value = $("#MainFeatureValue").val();
        Main_Unit = $("#MainUnit").val();
        Country_Id = $("#Locationid").val();
        Order_No = $("#order_no").val();
        LC_Number = $("#lc_number").val();
        LC_Date = $("#lc_date").val();
        Sales_Date = $("#sell_date").val();
        Delivery_Date = $("#Delivery_Date").val();
        Site_Id = $(".Site").val();
        Warehouse_Id = $(".Warehouse").val();
        Lot_Number = $("#Lot").val();
            VarData = [Company_Id, Customer_Id, Product_Type_Id, Total_Count, MainFeature_Id, MainFeature_Value, Main_Unit, Country_Id, Order_No, Sales_Date, Delivery_Date, Site_Id, Warehouse_Id, Lot_Number, OrderId]

        $("#DynaComb > div > div > div > select").each(function() {
            Dyna_Id = this.getAttribute('id');
            Dyna_Value = $(this).val();
            Dynamic_Attr.push([this.getAttribute('id'), $(this).val()]);
        });
        $("#DynaComb2 > div > div > div > input").each(function() {
            Dyna_Id = this.getAttribute('id');
            Dyna_Value = $(this).val();
            Dynamic_AttrTxt.push([this.getAttribute('id'), $(this).val(), $(this).attr("unitvalue")]);
        });
        //$("#GeneratedRows > tr").each(function() {
        //    Products_Details.push([$(this).find(".RowNumber").html(), $(this).find(".SLN").val(), $(this).find(".QTYVal").val(), $(this).find(".Unit").html()]);
        //});

        DTS = [VarData, Dynamic_Attr, Dynamic_AttrTxt];
        //console.log(DTS);


        var postData = {
            values: DTS
        };
        $.ajax({
            type: "POST",
            url: '@Url.Action("UpdateData", "Sales_Order")',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(postData),
            success: function(data) {
                alert(data);
                if (data[0].length != null) {

                    toastr.error(data[0], data[0].length);
                } else {
                    toastr.success(data[0], data[0].length);
                }
            }
        });
    });


        @*$("#AddtoList").click(function () {
            $.LoadingOverlay("show");
            var productData = [];
            $("#Products option:selected").each(function (key, value) {
                productData.push([$(value).val(), $(value).attr('QTY'),@Model.id,$(".Warehouse").val()])
            })
            console.log(productData);
              $.ajax({
                type: "POST",
                url: '@Url.Action("SendToLedger", "Sales_Order")',
                contentType: "application/json; charset=utf-8",
                   async: false,
                  data: JSON.stringify({ values: productData }),
                  success: function (data) {
                      $.LoadingOverlay("hide");
                    //$.each(data, function (key, value) {
                    // //   $("#Products").append("<option value=\""+ value.ProductId + "\">"+value.ProductSerial+"</option>")
                    //})
                }
            });
            Swal.fire('', 'Added to list.', 'success');
            $("#Products").empty();
            LoadProducts();
            LoadYetToSale(@Model.id);
        })*@


        $("#AddtoList").click(function () {
    $.LoadingOverlay("show");
    var productData = [];
    $("#Products option:selected").each(function (key, value) {
        productData.push([$(value).val(), $(value).attr('QTY'),@Model.id,$(".Warehouse").val()])
    })
    console.log(productData);
    $.ajax({
        type: "POST",
        url: '@Url.Action("SendToLedger", "Sales_Order")',
        contentType: "application/json; charset=utf-8",
        data: JSON.stringify({ values: productData }),
        success: function (data) {
            $.LoadingOverlay("hide");
            Swal.fire('', 'Added to list.', 'success');
            $("#Products").empty();
            LoadProducts();
            LoadYetToSale(@Model.id);
        }
    }).done(function() {
        // this code will execute after the AJAX call is complete
    });
});


    $("#SubmitBtn").click(function() {
        toastr.options = {
            "closeButton": true,
            "debug": false,
            "newestOnTop": false,
            "progressBar": true,
            "positionClass": "toast-top-full-width",
            "preventDuplicates": true,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "30000",
            "extendedTimeOut": "30000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        }


        OrderId = @Model.id;
        Lot_Number = $("#Lot").val();

        var OrderLot = [];
        OrderLot = [OrderId, Lot_Number]


        var postData = {
            values: OrderLot
        };
        $.ajax({
            type: "POST",
            url: '@Url.Action("SubmitData", "Sales_Order")',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(postData),
            success: function(data) {
                Swal.fire('Submitted', 'Sales order submitted successfully!', 'success').then(function () {
                         location.replace('@Url.Action("Edit", "Sales_Order")');
                })

            }
        });
        $(this).prop("disabled", true);
    });

                $(document).on("click", "#YetToSaleItemDelete", function() {

            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d93232',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.LoadingOverlay("show");
            $.ajax({
                type: "POST",
                url: '@Url.Action("DeleteYetToSale", "Sales_Order")',
                contentType: "application/json;charset=utf-8",
                data: JSON.stringify({
                    id: $(this).val()
                }),
                success: function(data) {
                    if (data == "Success") {
                        Swal.fire(
                            'Removed!',
                            'Product Removed.',
                            'success'
                        )
                        LoadProducts();
                        LoadYetToSale(@Model.id)
                        $.LoadingOverlay("hide");
                    } else {
                        Swal.fire(
                            'Removal Failed!',
                            data,
                            'error'
                        )
                        $.LoadingOverlay("hide");
                    }
                }
            })
            //alert("hi")
        }
    });
        });

  function LoadYetToSale(orderId) {
    $.ajax({
        type: "POST",
        url: '@Url.Action("YetToSaleItems", "Sales_Order")',
        contentType: "application/json;charset=utf-8",

        data: JSON.stringify({
            id: orderId
        }),
        async: false,
        success: function (data) {
            console.log(data.length)
            if (data.length === 0) {
                $("#UpdateBtn").show();
                $("#SubmitBtn").hide();
                EnableInputs();
            }
            else {
                $("#UpdateBtn").hide();
                $("#SubmitBtn").show();
                DisableInputs();
            }
            $("#YetToSale").empty();
            var counter = 0;
            var datalength = data.length;
            $.each(data, function(key, value) {


                $("#YetToSale").append("<tr><td>" + (datalength - counter) + "</td><td>" + value.Product.Product_Type.type_name + "</td><td>" + value.Product.product_serial + "</td><td>" + value.sale_count + "</td><td></td><td>" + moment(value.arrival_date).format("h:mm:ss a") + "</td><td class=\"hh\"><button   id=\"YetToSaleItemDelete\"  value=\"" + value.id + "\" class=\"btn-icon btn-icon-only btn btn-danger\"><i class=\"icon ion-android-close\"></i></button></td></tr>");
                counter++;

            });
        }
    })

            if ($("#status").val() == "C") {
                $("input, button, select").prop('disabled', true)
                $("#SubmitBtn").hide();
            }
        }


        function DisableInputs() {

            $(".OrderArea input,.OrderArea select").prop('disabled', true);


        }
        function EnableInputs() {

            $(".OrderArea input,.OrderArea select").prop('disabled', false);

        }

        function LoadDynamicFeature(eventType,productTypeId) {
        if (productTypeId != undefined && productTypeId != '') {
            MainFeature_Id = null;
            var json = {
                id: productTypeId
            }
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetFid", "Purchase_Order")', // Get Data to Generate all Combobox for Features
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(json),
                async: false,
                success: function(data) {
                    $("#Featureid").empty();
                    $("#DynaComb").empty();
                    $("#DynaComb2").empty();
                    $(".MainFeature").empty();
                    $(".MainUnit").empty();
                    $("#Featureid").append("<option value=" + ">" + "---- Please Select Feature ----" + "</option>")
                    var CounterA = 0;
                    var CounterB = 1;
                    var CounterC = 0;
                    var CounterD = 1;
                    $.each(data, function(key, value) {

                        if (value.status != "M" && value.Feature_Type.status != "T") {
                            if (CounterA == 0) {
                                $("#DynaComb").append("<div class=\"form-row\"></div>")
                            }
                            $("#DynaComb>:nth-child(" + CounterB + ")").append("<div class=\"col-md-2\"><div class=\"position-relative form-group\" ><label for=\"\" class=\"\">" + value.Feature_Type.type_name + "</label><select id=\"" + value.Feature_Type.id + "\"  class=\"form-control FT\ AllItem" + value.Feature_Type.id + "\"></select></div></div>")
                            //$("#DynaComb>:nth-child(" + CounterB + ")").append("<div class=\"col-md-2\"><div class=\"position-relative form-group\" ><label for=\"\" class=\"\">" + value.Feature_Type.type_name + "</label><select id=\"A\"  class=\"form-control FT\ AllItem" + value.Feature_Type.id + "\"></select></div></div>")
                            $("#Featureid").append("<option value=" + value.Feature_Type.id + ">" + value.Feature_Type.type_name + "</option>")
                            CounterA++;
                            if (CounterA >= 6) {
                                CounterB++;
                                CounterA = 0;
                            }
                        } else {
                            if (value.Feature_Type.status == "T" && value.status != "M") {

                                if (CounterC == 0) {
                                    $("#DynaComb2").append("<div class=\"form-row\"></div>")
                                }
                                $("#DynaComb2>:nth-child(" + CounterD + ")").append("<div class=\"col-md-2\"><div class=\"position-relative form-group\" ><label for=\"\" class=\"\">" + value.Feature_Type.type_name + "</label><input id=\"" + value.Feature_Type.id + "\"  class=\"form-control FeaturesTxtBox\ Text" + value.Feature_Type.id + "\"></input></div></div>")
                                $("#DynaComb2>:nth-child(" + CounterD + ")").append("<div class=\"col-md-2\"><div class=\"position-relative form-group\" ><label for=\"\" class=\"\">Unit</label><select id=\"" + value.Feature_Type.id + "\"  class=\"form-control FeaturesTxtBoxUnit DynaComb2FeatureUnit" + value.Feature_Type.id + "\"></select></div></div>")
                                $.ajax({
                                    type: "POST",
                                    url: '@Url.Action("GetUnit", "Purchase_Order")',
                                    contentType: "application/json; charset=utf-8",
                                    data: JSON.stringify({
                                        id: value.Feature_Type.id
                                    }),
                                    success: function(Unitdata) {
                                        //console.log(Unitdata)
                                        $.each(Unitdata, function(key, Unitvalue) {
                                            $(".DynaComb2FeatureUnit" + value.Feature_Type.id).append("<option value=\"" + Unitvalue.Unit_Measurement.id + "\">" + Unitvalue.Unit_Measurement.code + "</option>");
                                            // unitvalue

                                            $(".Text" + value.Feature_Type.id).attr("UnitValue", $(".DynaComb2FeatureUnit" + value.Feature_Type.id).val())
                                        });
                                    }
                                });


                                CounterC++;
                                if (CounterC >= 3) {
                                    CounterD++;
                                    CounterC = 0;
                                }
                            } else {
                                $(".MainFeature").append("<div class= \"position-relative form-group\" ><label for=\"\" class=\"\">" + value.Feature_Type.type_name + "</label><input id=\"MainFeatureValue\" class=\"form-control\"></div>")
                                MainFeature_Id = value.Feature_Type.id;
                                var json = {
                                    id: MainFeature_Id
                                }
                                $.ajax({
                                    type: "POST",
                                    url: '@Url.Action("GetUnit", "Purchase_Order")',
                                    contentType: "application/json; charset=utf-8",
                                    data: JSON.stringify(json),
                                    success: function(data) {
                                        $(".MainUnit").append("<div class=\"position-relative form-group\"><label for=\"\" class=\"\">Unit</label><select class=\"form-control\" id=\"MainUnit\"></select></div>");
                                        $.each(data, function(key, value) {
                                            //console.log(value);
                                            $("#MainUnit").append("<option value=\"" + value.Unit_Measurement.id + "\">" + value.Unit_Measurement.code + "</option>");
                                        });
                                    }
                                });
                            }
                        }
                    });
                    $(".FT").each(function() {
                        var fid = this.id;
                        if (fid != undefined && fid != '') {
                            var json = {
                                id: fid
                            }
                            $.ajax({
                                type: "POST",
                                url: '@Url.Action("GetFt", "Purchase_Order")', // Get Data to Fill Up all Generated Combobox with Features (Mainly Options)
                                contentType: "application/json; charset=utf-8",
                                data: JSON.stringify(json),
                                async: false,
                                success: function(data) {

                                    $.each(data, function(key, value) {

                                        var s = $("#DynaComb");
                                        //console.log(s);
                                        $('#' + fid).append("<option value=\"" + value.id + "\">" + value.feature_name + "</option>");
                                        //alert(value.feature_name + " " + value.id);
                                        //$("#A").append("<option value=" + value.id + ">" + value.feature_name + "</option>")
                                    });
                                }
                            });
                        }
                    })


  if (eventType != "change") {
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("GetFeatures", "Sales_Order")',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify({id: @Model.id}),
                    async: false,
                    success: function(dataGetFeatures) {
                        console.log(dataGetFeatures);
                        $("#MainFeatureValue").val(@Model.sale_count);
                        $("#MainUnit").val(@Model.Unit_Measurementid);

                        console.log(dataGetFeatures);
                        // Loop dynamic attr value
                        for (let i = 0; i < dataGetFeatures.length; i++) {
                            if (dataGetFeatures[i].b.status != "T") {
                                $('#' + dataGetFeatures[i].a.FeatureTypeId).val(dataGetFeatures[i].a.FearureId);
                            } else {
                                $('#' + dataGetFeatures[i].a.FeatureTypeId).val(dataGetFeatures[i].a.TxtValue);
                                $('.DynaComb2FeatureUnit' + dataGetFeatures[i].a.FeatureTypeId).val(dataGetFeatures[i].a.UnitId);
                            }
                        }
                    }
                })




            }


                    LoadSalesInfo(@Model.id)
                }
            });
        }


    }

                function LoadSalesInfo(orderId) {
               $.ajax({
        type: "POST",
        url: '@Url.Action("GetSalesOrderInfo", "Sales_Order")',
                   contentType: "application/json; charset=utf-8",
                   async:false,
        data: JSON.stringify({
            id: orderId
        }),
                   success: function (data) {
                       console.log(data)
                       $("#Lot").val(data[0].Lot)
                       $("#Delivery_Date").val(moment(data[0].DeliveryDate).format("MM/DD/YYYY"))
                       @*$("#Company1").val(@Model.from_company_id);
                       $("#Company2").val(@Model.to_company_id);
                       LoadSite($("#Company1").val(), 1);
                       LoadSite($("#Company2").val(), 2);
                       $("#Site1").val(data[0].FromSite);
                       $("#Site2").val(data[0].ToSite);
                       LoadWarehouse($("#Site1").val(), 1);
                       LoadWarehouse($("#Site2").val(), 2);
                       $("#Warehouse1").val(data[0].FromWarehouse);
                       $("#Warehouse2").val(data[0].ToWarehouse);

                       $.each(data, function (key, value) {
                           //alert(key);
                           //LoadSite($("#Company"+key+1).val(), key+1);
                       })*@
        }
    });
  }

    function Filldata(dataGetFeatures) {
        // console.log(dataGetFeatures);
        for (let i = 0; i < dataGetFeatures.length; i++) {
            if (dataGetFeatures[i].Feature.Feature_Type.status != "T") {
                $('#' + dataGetFeatures[i].Feature.Feature_Typeid).val(dataGetFeatures[i].Feature.id);
            } else {

                $('#' + dataGetFeatures[i].Feature.Feature_Typeid).val(dataGetFeatures[i].Value);
                $('.DynaComb2FeatureUnit' + dataGetFeatures[i].Feature.Feature_Typeid).val(dataGetFeatures[i].Unit_Measurementid);
            }

            //$('#' + dt[i].Feature.Feature_Typeid).val(dt[i].Feature.id);
        }
        }



                function LoadProducts() {
                    var OrderData = [@Model.id, $("#Product_Typeid").val(), $("#Companyid").val()]
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetProducts", "Sales_Order")',
                contentType: "application/json; charset=utf-8",
                async: false,
                data: JSON.stringify({ values: OrderData }),
                success: function (data) {
                    console.log(data)
                    $("#Products").empty();
                    $.each(data, function (key, value) {
                        $("#Products").append("<option QTY=" + value.QTY+" value=\""+ value.ProductId + "\">"+value.Serial+"</option>")
                    })
                }
            });

        }


    $('body').on('blur', '.SLN', function() {
        $(this).attr('value', $(this).val());

        if ($('.SLN[value="' + $(this).val() + '"]').length > 1) {
            //    $(this).focus();
            $(this).addClass("is-invalid");
        } else {
            $(this).removeClass("is-invalid");
        }
    });
                $("#Companyid").change(function () {
            var compid = $(this).val();

                if (compid != undefined && compid != '') {
        var json = {
            id: compid
        }
        $.ajax({
            type: "POST",
            url: '@Url.Action("GetSite", "Purchase_Order")',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(json),
            success: function(data) {
                $(".SiteLoader").empty();
                $(".SiteLoader").append("<div class=\"position-relative form-group\"><label for=\"\" class=\"\">Site</label><select class=\"form-control Site\"></select></div>")
                $.each(data, function(key, value) {
                    $(".Site").append("<option value=\"" + value.Locations.id + "\">" + value.Locations.name + "</option>");
                });

                var siteid = $(".Site").val();
                if (siteid != undefined && siteid != '') {
                    var json = {
                        id: siteid
                    }
                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("GetWh", "Purchase_Order")',
                        contentType: "application/json; charset=utf-8",
                        data: JSON.stringify(json),
                        success: function(data) {
                            $(".WarehouseLoader").empty();
                            $(".SiteProductCount").empty();
                            $(".WarehouseLoader").append("<div class=\"position-relative form-group\"><label for=\"\" class=\"\">Warehouse</label><select class=\"form-control Warehouse\"></select></div>")
                            $(".SiteProductCount").append("<div class=\"position-relative form-group\"><label for=\"\" class=\"\">Count</label><input class=\"form-control SiteProductCountVal  input-mask-trigger\" data-inputmask=\"'alias': 'decimal', 'groupSeparator': ',', 'autoGroup': true\" im-insert=\"true\"></div>")
                            $.each(data, function(key, value) {
                                //alert("hi");
                                $(".Warehouse").append("<option value=\"" + value.id + "\">" + value.name + "</option>");

                            });
                        }
                    });
                }
            }
        });
    }
        })
    $(document.body).on("change", ".FeaturesTxtBoxUnit", function() {
        $(".Text" + $(this).attr("id")).attr("UnitValue", $(this).val())
    })

        $(document.body).on("change", "#Locationid", function () {
            var Country = $("#Locationid  option:selected").text();
            if (Country == 'Bangladesh') {
                $("#SalesType").val("Local");
            } else {
                $("#SalesType").val("Import");
            }
        })

    </script>

}
