@model BJProduction.Models.Transfer_Order

@{
    ViewBag.Title = "Edit";
    Layout = "~/Views/Shared/index.cshtml";
}

<head>
    <link href="~/Content/Exp/Select2.css" rel="stylesheet" />
    <link href="~/Content/Exp/select2-bootstrap4.css" rel="stylesheet" />
    <!-- select2-bootstrap4-theme -->

</head>

<div class="row">
    <div class="col-lg-12 OrderArea">
        <div class="main-card mb-3 card">
            @using (Html.BeginForm())
            {
                <div class="card-header-tab card-header">
                    <div class="card-header-title font-size-lg text-capitalize font-weight-normal"><i class="header-icon lnr-laptop-phone mr-3 text-muted opacity-6"> </i>Create</div>
                    <div class="btn-actions-pane-right actions-icon-btn">
                        @Html.ActionLink("Back to List", "Index", null, new { @class = "btn-shadow btn btn-info" })
                    </div>
                </div>

                <div class="card-body">
                    @Html.AntiForgeryToken()



                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                    @Html.HiddenFor(model => model.id)
                    @Html.HiddenFor(model => model.status)
                    <div class="form-row">
                        <div class="col-md-2">
                            <div class="position-relative form-group">
                                @Html.LabelFor(model => model.order_no, new { @class = "" })

                                @Html.EditorFor(model => model.order_no, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.order_no, "", new { @class = "text-danger" })

                            </div>
                        </div>
                    </div>

                    <div class="form-row">

                        <div class="col-md-2">
                            <div class="position-relative form-group">
                                @Html.LabelFor(model => model.Product_Typeid, "Product_Typeid", new { @class = "" })

                                @Html.DropDownList("Product_Typeid", null, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.Product_Typeid, "", new { @class = "text-danger" })

                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="position-relative form-group">
                                @Html.LabelFor(model => model.qty, new { @class = "" })

                                @Html.EditorFor(model => model.qty, new { htmlAttributes = new { @class = "form-control", @type = "" } })
                                @Html.ValidationMessageFor(model => model.qty, "", new { @class = "text-danger" })

                            </div>
                        </div>


                        <div class="col-md-2">
                            <div class="position-relative form-group">
                                @Html.LabelFor(model => model.transfer_from_date, new { @class = "" })

                                @Html.EditorFor(model => model.transfer_from_date, new { htmlAttributes = new { @class = "form-control", @data_toggle = "datepicker" } })
                                @Html.ValidationMessageFor(model => model.transfer_from_date, "", new { @class = "text-danger" })

                            </div>
                        </div>

                        <div class="col-md-2 offset-md-2 MainFeature">

                        </div>
                        <div class="col-md-2 MainUnit">

                        </div>
                    </div>

                    <div id="DynaComb" class="">
                        <div id="1" class="form-row">
                            <div class="col-md-2">
                            </div>
                        </div>
                    </div>
                    <div id="DynaComb2" class="">
                        <div id="1" class="form-row">
                            <div class="col-md-2">
                            </div>
                        </div>
                    </div>


                </div>
            }
        </div>
    </div>
</div>


<div id="" class="" style="">
    <div class="row">
        <div class="col-md-6 From">
            <div class="main-card mb-3 card">
                <div class="card-body">
                    <h5 class="card-title">From</h5>

                    <div class="form-row">

                        <div class="col-md-12">
                            <div class="position-relative form-group">
                                <label for="" class="">From Company</label>
                                <select id="Company1" class="form-control Company"></select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="position-relative form-group">
                                <label for="" class="">From Site</label>
                                <select id="Site1" class="form-control Site"></select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="position-relative form-group">
                                <label for="" class="">From Warehouse</label>
                                <select id="Warehouse1" class="form-control Warehouse"></select>
                            </div>
                        </div>

                    </div>

                </div>
            </div>

        </div>
        <div class="col-md-6 To">
            <div class="main-card mb-3 card">
                <div class="card-body">
                    <h5 class="card-title">To</h5>
                    <div class="form-row">
                        <div class="col-md-12">
                            <div class="position-relative form-group">
                                <label for="" class="">To Company</label>
                                <select id="Company2" class="form-control Company"></select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="position-relative form-group">
                                <label for="" class="">To Site</label>
                                <select id="Site2" class="form-control Site"></select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="position-relative form-group">
                                <label for="" class="">To Warehouse</label>
                                <select id="Warehouse2" class="form-control Warehouse"></select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div class="col-md-12">
            <div class="main-card mb-3 card">
                <div class="card-body">
                    <h5 class="card-title">Product to Transfer</h5>
                    <div class="form-row">
                        <div class="col-md-10">
                            <div class="position-relative form-group">
                                <label for="" class="">Product Serial</label>
                                <select id="Products" class="Products form-control" multiple>
                                </select>
                            </div>
                        </div>

                        <div class="col-md-2">
                            <div class="position-relative form-group">
                                <label for="" class="" style="color:white"> .</label>
                                <button id="TransferBtn" class="mb-2 mr-2 btn btn-success btn-primary btn-lg btn-block">
                                    Add to Transfer List
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <table class="mb-0 table table-hover">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Item</th>
                                    <th>Serial No.</th>
                                    <th>Weight</th>
                                    <th>Unit</th>
                                    <th>Time</th>
                                    <th>From Site</th>
                                    <th>To Site</th>
                                    <th>From Warehouse</th>
                                    <th>To Warehouse</th>
                                </tr>
                            </thead>
                            <tbody id="YetToTransfer">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>


<div class="Button_Section" style=" position: fixed; bottom: 40px; right: 40px">
    @*<button class="btn btn-danger btn-lg">Cancel</button>*@
    <button id="SaveBtn" class="btn btn-success btn-lg" style="display:none">Save</button>
    <button id="UpdateBtn" class="btn btn-success btn-lg" style="display:none">Update</button>
    <button id="SubmitBtn" class="btn btn-success btn-lg" style="display:none">Submit Transfer</button>
</div>


@section scripts{

    <script type="text/javascript">

        $(document).ready(function () {
            $(".Products").select2({
                theme: 'bootstrap4',
                closeOnSelect: false
            });
            if ($("#Products").val().length === 0) {
                $("#TransferBtn").prop("disabled", true);
            }
            else {
                $("#TransferBtn").prop("disabled", false);
            }
            $("#Products").on('change', function (e) {
                if ($("#Products").val().length === 0) {
                    $("#TransferBtn").prop("disabled", true);
                }
                else {
                    $("#TransferBtn").prop("disabled", false);
                }
            });

            LoadCompany("Company1");
            LoadCompany("Company2");
            LoadDynamicFeature("", $("#Product_Typeid").val());
            console.log($('.m').val())
            LoadTransferInfo(@Model.id)
            LoadProducts();
            LoadYetToTransfer(@Model.id)
        })




        // Functions


        function LoadCompany(HTMLEId) {
    $.ajax({
        type: "POST",
        url: '@Url.Action("GetCompany", "Home")',
        contentType: "application/json; charset=utf-8",
       // async: false,
        data: JSON.stringify(null),
        success: function(data) {
            $("#" + HTMLEId).empty();
            $("#" + HTMLEId).append("<option value=\"Please select\">Please Select a Company</option>")
            $.each(data, function(key, value) {
                $("#" + HTMLEId).append("<option value=" + value.Id + ">" + value.Company_Name + "</option>")
            });
          //  LoadSite($("#"+HTMLEId).val(), "Load");
        }
    });
        }

        function LoadSite(companyid, HTMLEId) {

    var json = {
        id: companyid
    }
    $.ajax({
        type: "POST",
        url: '@Url.Action("GetSite", "Home")',
        contentType: "application/json; charset=utf-8",
        async: false,
        data: JSON.stringify(json),
        success: function(data) {
            $("#Site" + HTMLEId).empty();
            $.each(data, function (key, value) {
                $("#Site" + HTMLEId).append("<option value=\"" + value.Locations.id + "\">" + value.Locations.name + "</option>");
            });
            LoadWarehouse($("#Site" + HTMLEId).val(), HTMLEId);
        }
    });
        }
        function LoadWarehouse(siteId,HTMLEId) {

    $.ajax({
        type: "POST",
        url: '@Url.Action("GetWh", "Purchase_Order")',
        contentType: "application/json; charset=utf-8",
        async:false,
        data: JSON.stringify({
            id: siteId
        }),
        success: function (data) {
            $("#Warehouse" + HTMLEId).empty();
            $.each(data, function(key, value) {
                //alert("hi");
                $("#Warehouse" + HTMLEId).append("<option value=\"" + value.id + "\">" + value.name + "</option>");

            });
        }
    });

}
        function LoadTransferInfo(orderId) {
               $.ajax({
        type: "POST",
        url: '@Url.Action("GetTransferInfo", "Transfer_Order")',
                   contentType: "application/json; charset=utf-8",
                   async:false,
        data: JSON.stringify({
            id: orderId
        }),
                   success: function (data) {
                       console.log(data)

                       $("#Company1").val(@Model.from_company_id);
                       $("#Company2").val(@Model.to_company_id);
                       LoadSite($("#Company1").val(), 1);
                       LoadSite($("#Company2").val(), 2);
                       $("#Site1").val(data[0].FromSite);
                       $("#Site2").val(data[0].ToSite);
                       LoadWarehouse($("#Site1").val(), 1);
                       LoadWarehouse($("#Site2").val(), 2);
                       $("#Warehouse1").val(data[0].FromWarehouse);
                       $("#Warehouse2").val(data[0].ToWarehouse);

                       $.each(data, function (key, value) {
                           //alert(key);
                           //LoadSite($("#Company"+key+1).val(), key+1);
                       })

            console.log(data);
        }
    });
  }
function LoadDynamicFeature(eventType, productid) {

    $.ajax({
        type: "POST",
        url: '@Url.Action("GetFid", "Purchase_Order")',
        contentType: "application/json; charset=utf-8",
        async: false,
        data: JSON.stringify({
            id: productid
        }),
        success: function(data) {
            $("#Featureid").empty();
            $("#DynaComb").empty();
            $("#DynaComb2").empty();
            $(".MainFeature").empty();
            $(".MainUnit").empty();
            // $("#Featureid").append("<option value=" + ">" + "---- Please Select Feature ----" + "</option>")
            var CounterA = 0;
            var CounterB = 1;
            var CounterC = 0;
            var CounterD = 1;
            $.each(data, function(key, value) {

                if (value.status != "M" && value.Feature_Type.status != "T") {
                    if (CounterA == 0) {
                        $("#DynaComb").append("<div class=\"form-row\"></div>")
                    }
                    $("#DynaComb>:nth-child(" + CounterB + ")").append("<div class=\"col-md-2\"><div class=\"position-relative form-group\" ><label for=\"\" class=\"\">" + value.Feature_Type.type_name + "</label><select id=\"" + value.Feature_Type.id + "\"  class=\"form-control Features\ AllItem" + value.Feature_Type.id + "\"></select></div></div>")
                    //$("#Featureid").append("<option value=" + value.Feature_Type.id + ">" + value.Feature_Type.type_name + "</option>")
                    CounterA++;
                    if (CounterA >= 6) {
                        CounterB++;
                        CounterA = 0;
                    }
                } else {

                    if (value.Feature_Type.status == "T" && value.status != "M") {


                        if (CounterC == 0) {
                            $("#DynaComb2").append("<div class=\"form-row\"></div>")
                        }
                        $("#DynaComb2>:nth-child(" + CounterD + ")").append("<div class=\"col-md-2\"><div class=\"position-relative form-group\" ><label for=\"\" class=\"\">" + value.Feature_Type.type_name + "</label><input id=\"" + value.Feature_Type.id + "\"  class=\"form-control FeaturesTxtBox\ Text" + value.Feature_Type.id + "\"></input></div></div>")
                        $("#DynaComb2>:nth-child(" + CounterD + ")").append("<div class=\"col-md-2\"><div class=\"position-relative form-group\" ><label for=\"\" class=\"\">Unit</label><select id=\"" + value.Feature_Type.id + "\"  class=\"form-control FeaturesTxtBoxUnit DynaComb2FeatureUnit" + value.Feature_Type.id + "\"></select></div></div>")

                        $.ajax({
                            type: "POST",
                            url: '@Url.Action("GetUnit", "Purchase_Order")',
                            contentType: "application/json; charset=utf-8",
                            data: JSON.stringify({
                                id: value.Feature_Type.id
                            }),
                            success: function(Unitdata) {

                                $.each(Unitdata, function(key, Unitvalue) {
                                    $(".DynaComb2FeatureUnit" + value.Feature_Type.id).append("<option value=\"" + Unitvalue.Unit_Measurement.id + "\">" + Unitvalue.Unit_Measurement.code + "</option>");
                                    $(".Text" + value.Feature_Type.id).attr("UnitValue", $(".DynaComb2FeatureUnit" + value.Feature_Type.id).val());
                                });
                                $(document.body).on("change", ".FeaturesTxtBoxUnit", function () {
                                    $(".Text" + $(this).attr("id")).attr("UnitValue", $(this).val())
                                })
                            }
                        });


                        CounterC++;
                        if (CounterC >= 3) {
                            CounterD++;
                            CounterC = 0;
                        }

                    } else {
                        $(".MainFeature").append("<div class= \"position-relative form-group\" ><label for=\"\" class=\"\">" + value.Feature_Type.type_name + "</label><input id=\"MainFeatureValue\" class=\"form-control\"></div>")
                        mainFeatureId = value.Feature_Type.id;
                        var json = {
                            id: mainFeatureId
                        }
                        $.ajax({
                            type: "POST",
                            url: '@Url.Action("GetUnit", "Purchase_Order")',
                            contentType: "application/json; charset=utf-8",
                            data: JSON.stringify(json),
                            success: function(data) {

                                $(".MainUnit").append("<div class=\"position-relative form-group\"><label for=\"\" class=\"\">Unit</label><select class=\"form-control\" id=\"MainUnit\"></select></div>");
                                $.each(data, function(key, value) {
                                    $("#MainUnit").append("<option value=\"" + value.Unit_Measurement.id + "\">" + value.Unit_Measurement.code + "</option>");
                                });
                            }
                        });
                    }
                }
            });
            $(".Features").each(function() {
                var fid = this.id;
                if (fid != undefined && fid != '') {
                    var json2 = {
                        id: fid
                    }
                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("GetFt", "Purchase_Order")',
                        contentType: "application/json; charset=utf-8",
                        data: JSON.stringify(json2),
                        async: false,
                        success: function(data) {

                            $.each(data, function(key, value) {
                                $('#' + fid).append("<option value=\"" + value.id + "\">" + value.feature_name + "</option>");
                            });
                        }
                    });
                }
            })

            if (eventType != "change") {
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("GetFeatures", "Transfer_Order")',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify({id: @Model.id}),
                    async: false,
                    success: function(dataGetFeatures) {
                        console.log(dataGetFeatures);
                        $("#MainFeatureValue").val(@Model.tr_count);
                        $("#MainUnit").val(@Model.Unit_Measurementid);

                        console.log(dataGetFeatures);
                        // Loop dynamic attr value
                        for (let i = 0; i < dataGetFeatures.length; i++) {
                            if (dataGetFeatures[i].b.status != "T") {
                                $('#' + dataGetFeatures[i].a.FeatureTypeId).val(dataGetFeatures[i].a.FearureId);
                            } else {

                                $('#' + dataGetFeatures[i].a.FeatureTypeId).val(dataGetFeatures[i].a.TxtValue);
                                $('.DynaComb2FeatureUnit' + dataGetFeatures[i].a.FeatureTypeId).val(dataGetFeatures[i].a.UnitId);
                            }
                        }
                    }
                })
            }
        }
    });
        }
        function LoadProducts() {
            var OrderData = [@Model.id, $("#Product_Typeid").val(), $("#Company1").val(), $("#Warehouse1").val()]
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetProducts", "Transfer_Order")',
                contentType: "application/json; charset=utf-8",
                async: false,
                data: JSON.stringify({ values: OrderData }),
                success: function (data) {
                    console.log(data)
                    $("#Products").empty();
                    $.each(data, function (key, value) {
                        $("#Products").append("<option QTY=" + value.QTY+" value=\""+ value.ProductId + "\">"+value.Serial+"</option>")
                    })
                }
            });
         
        }


        function LoadYetToTransfer(orderId) {
    $.ajax({
        type: "POST",
        url: '@Url.Action("YetToTransferItems", "Transfer_Order")',
        contentType: "application/json;charset=utf-8",

        data: JSON.stringify({
            id: orderId
        }),
        async: false,
        success: function (data) {
            console.log(data.length)
            if (data.length === 0) {
                $("#UpdateBtn").show();
                $("#SubmitBtn").hide();
                EnableInputs();
            }
            else {
                $("#UpdateBtn").hide();
                $("#SubmitBtn").show();
                DisableInputs();
            }
            $("#YetToTransfer").empty();
            var counter = 0;
            var datalength = data.length;
            $.each(data, function(key, value) {


                $("#YetToTransfer").append("<tr><td>" + (datalength - counter) + "</td><td>" + value.Product.Product_Type.type_name + "</td><td>" + value.Product.product_serial + "</td><td>" + value.tr_count + "</td><td></td><td>" + moment(value.arrival_date).format("h:mm:ss a") + "</td><td>" + $("#Site1 option:selected").text() + "</td><td>" + $("#Site2 option:selected").text() + "</td><td>" + $("#Warehouse1 option:selected").text() + "</td><td>" + $("#Warehouse2 option:selected").text() + "</td><td class=\"hh\"><button   id=\"YetToTransferItemDelete\"  value=\"" + value.id + "\" class=\"btn-icon btn-icon-only btn btn-danger\"><i class=\"icon ion-android-close\"></i></button></td></tr>");
                counter++;

            });
        }
    })
           
            if ($("#status").val() == "C") {
                $("input, button, select").prop('disabled', true)
                $("#SubmitBtn").hide();
            }  }


        function DisableInputs(){

            $(".OrderArea input,.OrderArea select").prop('disabled', true);
            $(".From input,.From select").prop('disabled', true);
            $(".To input,.To select").prop('disabled', true);

        }
        function EnableInputs() {

            $(".OrderArea input,.OrderArea select").prop('disabled', false);
            $(".From input,.From select").prop('disabled', false);
            $(".To input,.To select").prop('disabled', false);

        }
        // Change Events
        var i = 1, j = 2;
        $(document).on("change", "#Company" + i, (function () {
            LoadSite($(this).val(), i);
        }))

        $(document).on("change", "#Company" + j, (function () {
            LoadSite($(this).val(), j);

        }))

        $(document).on("change", "#Site" + i, (function () {
            LoadWarehouse($(this).val(), i);
        }))

        $(document).on("change", "#Site" + j, (function () {
            LoadWarehouse($(this).val(), j);

        }))

        $(document).on("change", "#Product_Typeid", (function () {
            LoadDynamicFeature("change",$(this).val());

        }))




        // Global Variables

        var orderNo, productTypeId, qty, transferDate, fromCompany, toCompany, fromSite, toSite, fromWarehouse, toWarehouse, transferCount, unitId, mainFeatureId;
        var Dynamic_Attr = [], VarData = [], DTS = [], Dynamic_AttrTxt = [];

        // Click Events

        $("#SaveBtn").click(function () {
            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": false,
                "progressBar": true,
                "positionClass": "toast-top-full-width",
                "preventDuplicates": true,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "30000",
                "extendedTimeOut": "30000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            }

            VarData, Dynamic_Attr, DTS = null;

                    orderNo = $("#order_no").val();
                    productTypeId = $("#Product_Typeid").val();
                    qty = $("#qty").val();
                    transferDate = $("#transfer_from_date").val();
                    fromCompany = $("#Company1").val();
                    toCompany = $("#Company2").val();
                    fromSite = $("#Site1").val();
                    toSite = $("#Site2").val();
                    fromWarehouse = $("#Warehouse1").val();
                    toWarehouse = $("#Warehouse2").val();

            //mainFeatureId = $("#").val();
            transferCount = $("#MainFeatureValue").val();
            unitId = $("#MainUnit").val();

                    VarData = [orderNo, productTypeId, qty, transferDate, fromCompany, toCompany, fromSite, toSite, fromWarehouse, toWarehouse, transferCount, unitId, mainFeatureId]

            $("#DynaComb > div > div > div > select").each(function () {
                Dyna_Id = this.getAttribute('id');
                Dyna_Value = $(this).val();
                Dynamic_Attr.push([this.getAttribute('id'), $(this).val()]);
            });
            $("#DynaComb2 > div > div > div > input").each(function () {
                Dyna_Id = this.getAttribute('id');
                Dyna_Value = $(this).val();
               // alert($(this).attr("unitvalue"))
                Dynamic_AttrTxt.push([this.getAttribute('id'), $(this).val(), $(this).attr("unitvalue")]);
            });


            DTS = [VarData, Dynamic_Attr, Dynamic_AttrTxt];
            console.log(DTS);


            var postData = { values: DTS };
                  $.ajax({
                    type: "POST",
                    url: '@Url.Action("SaveData", "Transfer_Order")',
                    contentType: "application/json; charset=utf-8",
                      data: JSON.stringify(postData),
                      success: function (data) {
                          location.replace('@Url.Action("Edit", "Transfer_Order")'+"/"+data);

                        //  alert(data);
                          if (data[0].length != null) {

                              toastr.error(data[0], data[0].length);
                          }
                          else {
                              toastr.success(data[0], data[0].length);
                          }
                      }
                });

            $("#Start").prop("disabled", false);
            $(this).prop("disabled", true);

        });
        $("#UpdateBtn").click(function () {
            DTS.length = 0;
            VarData.length = 0;
            Dynamic_Attr.length = 0;
            Dynamic_AttrTxt.length = 0;
            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": false,
                "progressBar": true,
                "positionClass": "toast-top-full-width",
                "preventDuplicates": true,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "30000",
                "extendedTimeOut": "30000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            }

            VarData, Dynamic_Attr, DTS = null;

                    orderNo = $("#order_no").val();
                    productTypeId = $("#Product_Typeid").val();
                    qty = $("#qty").val();
                    transferDate = $("#transfer_from_date").val();
                    fromCompany = $("#Company1").val();
                    toCompany = $("#Company2").val();
                    fromSite = $("#Site1").val();
                    toSite = $("#Site2").val();
                    fromWarehouse = $("#Warehouse1").val();
                    toWarehouse = $("#Warehouse2").val();

            //mainFeatureId = $("#").val();
            transferCount = $("#MainFeatureValue").val();
            unitId = $("#MainUnit").val();

                    VarData = [orderNo, productTypeId, qty, transferDate, fromCompany, toCompany, fromSite, toSite, fromWarehouse, toWarehouse, transferCount, unitId, mainFeatureId,@Model.id]

            $("#DynaComb > div > div > div > select").each(function () {
                Dyna_Id = this.getAttribute('id');
                Dyna_Value = $(this).val();
                Dynamic_Attr.push([this.getAttribute('id'), $(this).val()]);
            });
            $("#DynaComb2 > div > div > div > input").each(function () {
                Dyna_Id = this.getAttribute('id');
                Dyna_Value = $(this).val();
                //alert($(this).attr("unitvalue"))
                Dynamic_AttrTxt.push([this.getAttribute('id'), $(this).val(), $(this).attr("unitvalue")]);
            });


            DTS = [VarData, Dynamic_Attr, Dynamic_AttrTxt];
            console.log(DTS);


            var postData = { values: DTS };
                  $.ajax({
                    type: "POST",
                    url: '@Url.Action("UpdateData", "Transfer_Order")',
                    contentType: "application/json; charset=utf-8",
                      data: JSON.stringify(postData),
                      success: function (data) {
                          LoadProducts();
                         // alert(data);
                          Swal.fire('Update','Successfully Update','success')
                      }
                });

                });
        $("#TransferBtn").click(function () {
            var productData = [];
            $("#Products option:selected").each(function (key, value) {
                productData.push([$(value).val(), $(value).attr('QTY'),@Model.id,$("#Warehouse2").val()])
            })
            console.log(productData);
              $.ajax({
                type: "POST",
                url: '@Url.Action("SendToLedger", "Transfer_Order")',
                contentType: "application/json; charset=utf-8",
                   async: false,
                  data: JSON.stringify({ values: productData }),
                success: function (data) {
                    $.each(data, function (key, value) {
                        $("#Products").append("<option value=\""+ value.ProductId + "\">"+value.ProductSerial+"</option>")
                    })
                }
            });
            Swal.fire('', 'Added to transfer list.', 'success');
            $("#Products").empty();
            LoadProducts();
            LoadYetToTransfer(@Model.id);
        })
        $(document).on("click", "#YetToTransferItemDelete", function() {

            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d93232',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
            $.ajax({
                type: "POST",
                url: '@Url.Action("DeleteYetToTransfer", "Transfer_Order")',
                contentType: "application/json;charset=utf-8",
                data: JSON.stringify({
                    id: $(this).val()
                }),
                success: function(data) {
                    if (data == "Success") {
                        Swal.fire(
                            'Removed!',
                            'Product Removed.',
                            'success'
                        )
                        LoadProducts();
                        LoadYetToTransfer(@Model.id)
                    } else {
                        Swal.fire(
                            'Removal Failed!',
                            data,
                            'error'
                        )
                    }
                }
            })
            //alert("hi")
        }
    });
        });
        $("#SubmitBtn").click(async function() {
    var text = "";
    var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    for (var i = 0; i < 3; i++) {
        text += possible.charAt(Math.floor(Math.random() * possible.length));
    }
    const {
        value: ConfirmationValue
    } = await Swal.fire({
        title: 'Enter Below Text to Proceed Transfer',
        icon: 'info',
        html: '<h3 style="font-weight: bold">' + text + '</h3>',
        input: 'text',

        inputValue: '',
        showCancelButton: false,
    })

            if (ConfirmationValue == text) {



                 $.ajax({
                type: "POST",
                url: '@Url.Action("SubmitTransfer", "Transfer_Order")',
                contentType: "application/json;charset=utf-8",
                     data: JSON.stringify({
                         id: @Model.id
                }),
                success: function(data) {
                    if (data == "Success") {
                        Swal.fire(
                            'Saved!',
                            'Transfer completed.',
                            'success'
                        ).then(function () {
                            location.replace('@Url.Action("Edit", "Transfer_Order")');
                        })

                    } else {
                        Swal.fire(
                            'Transfer Failed!',
                            data,
                            'error'
                        )
                    }
                }
            })

        Swal.fire('','Saved','success')
    }
})
        // ###########################################################################################
        //var cls = "Company"
        //$(document.body).on("change", "select." + cls + "", function () {
        //    var selectedItems = [];
        //    var prevSelectedItem = $(this).data("key");
        //    if (prevSelectedItem) {
        //        var index = selectedItems.indexOf(prevSelectedItem);
        //        if (index > -1) {
        //            selectedItems.splice(index, 1);
        //        }
        //        $("select." + cls + " option[value='" + prevSelectedItem + "']").show();
        //    }

        //    var selectedItem = $(this).val();
        //    if (selectedItem === "Please select") {
        //        return;
        //    }

        //    if (selectedItems.includes(selectedItem)) {
        //        $(this).val("Please select");
        //        return;
        //    }

        //    selectedItems.push(selectedItem);
        //    $(this).data("key", selectedItem);

        //    $("select." + cls).each(function () {
        //        if ($(this).val() === selectedItem) {
        //            return;
        //        }
        //        $(this)
        //            .find("option[value='" + selectedItem + "']")
        //            .hide();
        //    });
        //});



    </script>

}